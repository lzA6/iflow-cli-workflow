# 增强版 /sc:test 指令使用指南

## 概述

增强版 `/sc:test` 指令是对原有测试指令的全面升级，提供了以下核心功能：

### 🚀 核心功能

1. **强制AI信息传递** - 确保AI完全理解项目状态和测试要求
2. **项目结构树对比分析** - 深度分析项目结构变化和影响
3. **自动优化报告生成** - 基于项目结构逐一排查生成优化报告
4. **内置深度分析扫描审查** - 全面的代码质量、安全性、性能扫描
5. **完整依据和解释系统** - 为每个决策提供详细推理过程和证据链
6. **功能特点分析模块** - 深入分析每个文件的功能特点、优缺点和价值

## 📋 使用方法

### 基本使用

```bash
# 进入项目目录
cd /path/to/your/project

# 运行增强版测试
python .iflow/commands/sc/test_enhanced_launcher.py
```

### 高级使用

```bash
# 直接运行主程序
python .iflow/commands/sc/test_enhanced_main.py

# 非交互模式
python .iflow/commands/sc/test_enhanced_main.py --no-interactive

# 禁用特定功能
python .iflow/commands/sc/test_enhanced_main.py --no-deep-analysis
python .iflow/commands/sc/test_enhanced_main.py --no-optimization-report
```

## 🛠️ 模块架构

### 1. AI信息强制传递器 (`ai_information_forcer.py`)

**功能**: 确保AI完全理解项目状态和测试要求

**特性**:
- 创建完整项目上下文
- 生成测试要求上下文
- 建立决策依据框架
- 提供功能分析上下文

**输出**: `.iflow/temp_docs/ai_context/` 目录下的上下文文件

### 2. 项目结构分析器 (`structure_analyzer.py`)

**功能**: 深度分析项目结构变化

**特性**:
- 文件级详细分析
- 结构变化对比
- 影响评估
- 依赖关系分析

**输出**: 结构对比报告和变更分析

### 3. 优化报告生成器 (`optimization_report_generator.py`)

**功能**: 基于项目结构逐一排查生成优化报告

**特性**:
- 逐一文件分析
- 问题分类和优先级排序
- 优化策略生成
- 实施计划制定

**输出**: `reports/optimization_report_*.json` 和 `.md` 文件

### 4. 深度分析扫描器 (`deep_analysis_scanner.py`)

**功能**: 内置深度分析扫描审查

**特性**:
- 安全性深度扫描
- 性能深度扫描
- 代码质量扫描
- 架构分析
- 反模式检测

**输出**: `reports/deep_scan_results_*.json` 文件

### 5. 完整依据解释系统 (`comprehensive_justification_system.py`)

**功能**: 为每个决策提供详细推理过程和证据链

**特性**:
- 证据收集和验证
- 推理链构建
- 自我反省机制
- 决策记录生成

**输出**: `.iflow/temp_docs/decisions/` 目录下的决策记录

### 6. 功能特点分析模块 (`feature_analysis_module.py`)

**功能**: 深入分析每个文件的功能特点、优缺点和价值

**特性**:
- 功能特征识别
- 优势劣势分析
- 替代方案评估
- 保留/删除理由生成

**输出**: 每个文件的详细功能分析报告

## 📊 输出报告

### 报告类型

1. **执行摘要报告** - 整体分析概览
2. **深度扫描报告** - 安全、性能、质量问题详情
3. **功能分析报告** - 每个文件的功能特点分析
4. **决策记录报告** - 每个决策的详细依据
5. **优化建议报告** - 具体的优化策略和实施计划
6. **结构对比报告** - 项目结构变化分析

### 报告位置

所有报告都保存在 `reports/` 目录下，包括：
- JSON格式的详细数据
- Markdown格式的可读报告
- 时间戳标识的版本管理

## 🎯 交互模式

增强版 `/sc:test` 提供丰富的交互模式：

### 可用操作

1. **查看深度扫描结果** - 查看安全、性能、质量问题统计
2. **查看功能特点分析** - 浏览文件功能分析结果
3. **查看决策记录** - 查看每个决策的详细依据
4. **查看项目结构变化** - 分析结构变化和影响
5. **查看优化建议** - 获取具体的优化策略
6. **导出详细报告** - 导出所有分析报告
7. **重新分析特定文件** - 对特定文件重新分析

### 使用技巧

- 交互模式下可以深入探索每个分析结果
- 支持重新分析特定文件
- 提供详细的决策依据和推理过程
- 可以导出完整的分析报告

## ⚙️ 配置选项

### 命令行参数

```bash
--project-root          # 指定项目根目录（默认：当前目录）
--no-interactive        # 禁用交互模式
--no-ai-awareness       # 禁用AI信息传递
--no-deep-analysis      # 禁用深度分析
--no-optimization-report # 禁用优化报告
--no-structure-comparison # 禁用结构对比
```

### 自定义配置

可以通过修改各个模块的配置文件来自定义分析规则和标准。

## 🔍 分析标准

### 安全性标准

- **危险函数检测** - eval、exec等高风险函数
- **硬编码密钥检测** - 密码、密钥等敏感信息
- **SQL注入风险** - 潜在的注入漏洞
- **文件路径安全** - 路径遍历风险

### 性能标准

- **循环中的数据库查询** - 性能瓶颈检测
- **大文件处理** - 内存使用优化
- **低效算法** - 算法复杂度分析
- **缓存使用** - 缓存策略评估

### 代码质量标准

- **圈复杂度** - 代码复杂度评估
- **可维护性指数** - 维护难度分析
- **代码重复率** - DRY原则遵循度
- **注释覆盖率** - 文档完整性

### 架构标准

- **模块依赖** - 依赖关系分析
- **耦合度** - 模块间耦合评估
- **设计模式** - 设计模式使用情况
- **反模式检测** - 常见反模式识别

## 📈 质量保证

### 决策依据

每个决策都基于：
- **多维度证据收集** - 代码分析、指标数据、依赖关系等
- **完整推理链** - 逻辑清晰的推理过程
- **自我反省机制** - 识别偏见和局限性
- **替代方案比较** - 全面评估各种选择

### 置信度评估

- **证据置信度** - 基于证据来源和质量
- **推理置信度** - 基于推理逻辑的严密性
- **自我反省调整** - 基于反省结果的调整
- **综合置信度** - 多因素综合评估

## 🚨 注意事项

### 系统要求

- Python 3.8+
- 足够的磁盘空间存储报告
- 充足的内存处理大型项目

### 性能考虑

- 大型项目分析可能需要较长时间
- 建议在性能较好的机器上运行
- 可以使用 `--no-deep-analysis` 跳过耗时操作

### 数据安全

- 所有分析数据都保存在本地
- 不会上传任何代码到外部服务器
- 敏感信息会被识别和警告

## 🛠️ 故障排除

### 常见问题

1. **模块导入错误**
   ```
   确保在项目根目录运行
   检查 Python 路径设置
   ```

2. **内存不足**
   ```
   使用 --no-deep-analysis 参数
   分批分析大型项目
   ```

3. **权限问题**
   ```
   确保有读写权限
   检查目录权限设置
   ```

### 调试模式

可以通过查看各个模块的日志输出来调试问题。

## 📞 支持

如果遇到问题或需要帮助：

1. 查看生成的报告文件了解详细错误信息
2. 检查 `.iflow/temp_docs/` 目录下的中间文件
3. 使用 `--no-interactive` 模式获取更详细的日志输出

## 🔄 版本历史

- **v2.0.0** - 增强版发布，包含所有核心功能
- **v1.0.0** - 基础版本，仅包含基本测试功能

---

*增强版 /sc:test - 让项目分析更智能、更全面、更可靠*