---
name: test
description: "增强版测试和质量保证系统 - 智能决策支持"
category: utility
complexity: enhanced
mcp-servers: [playwright]
personas: [qa-specialist, ai-analyst]
---

# /sc:test - 增强版测试和质量保证系统

## 触发条件
- 单元测试、集成测试或端到端测试的执行请求
- 覆盖率分析和质量门控验证需求
- 连续测试和监视模式场景
- 测试失败分析和调试需求
- **新增**: 项目结构分析和优化需求
- **新增**: 深度代码质量审查需求
- **新增**: 智能决策支持需求

## 使用方法

### 🚀 基础使用（推荐）
```bash
# 运行增强版完整分析
python .iflow/commands/sc/test_enhanced_launcher.py

# 或直接运行主程序
python .iflow/commands/sc/test_enhanced_main.py

# 兼容原始版本 - 基础测试执行
python .iflow/commands/sc/test_enhanced.py
```

### 🔄 兼容原始版本命令
```bash
# 基础测试执行（完全兼容原始版本）
python .iflow/commands/sc/test_enhanced.py

# 目标覆盖率分析
python .iflow/commands/sc/test_enhanced.py src/components --type unit --coverage

# 浏览器测试（自动激活Playwright MCP）
python .iflow/commands/sc/test_enhanced.py --type e2e

# 开发监视模式
python .iflow/commands/sc/test_enhanced.py --watch --fix
```

### 🔧 高级选项
```bash
# 非交互模式
python .iflow/commands/sc/test_enhanced_main.py --no-interactive

# 自定义项目根目录
python .iflow/commands/sc/test_enhanced_main.py --project-root /path/to/project

# 禁用特定功能
python .iflow/commands/sc/test_enhanced_main.py --no-deep-analysis
python .iflow/commands/sc/test_enhanced_main.py --no-optimization-report
python .iflow/commands/sc/test_enhanced_main.py --no-structure-comparison

# 自定义覆盖率阈值
python .iflow/commands/sc/test_enhanced.py --coverage-threshold 30
```

## 🚀 行为流程

### 📚 原始版本5步流程（完全兼容）
1. **发现**: 使用运行器模式和约定对可用测试进行分类
2. **配置**: 设置适当的测试环境和执行参数
3. **执行**: 运行测试并监控和实时进度跟踪
4. **分析**: 生成覆盖率报告和失败诊断
5. **报告**: 提供可操作的建议和质量指标

### 🌟 增强版8步深度分析流程
1. **AI信息强制传递** - 确保AI完全理解项目状态和测试要求
2. **项目结构对比分析** - 深度分析项目结构变化和影响
3. **深度分析扫描审查** - 内置的全面代码质量、安全性、性能扫描
4. **功能特点分析** - 深入分析每个文件的功能特点、优缺点和价值
5. **决策记录生成** - 为每个决策提供详细推理过程和证据链
6. **自动优化报告生成** - 基于项目结构逐一排查生成优化报告
7. **交互式分析处理** - 支持用户深入探索分析结果
8. **综合报告生成** - 生成最终的综合分析报告

### 🔍 核心增强特性
- **智能决策支持**: 每个文件决策都有详细的分析和推理
- **全面证据收集**: 多维度证据支持每个决策
- **自我反省机制**: 识别偏见和局限性
- **完整推理链**: 逻辑严密的决策过程
- **交互式探索**: 深入分析每个文件和决策
- **完全兼容**: 保留原始版本所有功能和行为

## 🤖 AI集成增强

### AI信息强制传递系统
- **项目上下文**: 完整项目结构和配置信息
- **测试要求**: 明确的分析目标和成功标准
- **决策框架**: 系统化的决策依据和推理标准
- **功能分类**: 精确的功能分析和价值评估

### QA专家角色增强
- **深度代码审查**: 全面的安全性、性能、质量分析
- **架构评估**: 模块依赖、耦合度、设计模式分析
- **决策支持**: 基于证据的智能决策建议
- **优化策略**: 具体的改进方案和实施计划

## 🛠️ 工具协调增强

### 核心分析工具
- **AI信息强制传递器**: 确保AI理解项目状态
- **项目结构分析器**: 深度结构对比和变化分析
- **优化报告生成器**: 基于结构的自动化优化报告
- **深度分析扫描器**: 内置的全面代码分析
- **完整依据系统**: 决策推理和证据链管理
- **功能分析模块**: 文件功能特点和价值评估

### 输出生成工具
- **Bash**: 测试执行和环境管理
- **Glob**: 文件发现和模式匹配
- **Grep**: 结果解析和深度分析
- **Write**: 多格式报告生成（JSON、Markdown）

## 🎯 关键模式增强

### 🔄 项目结构分析模式
- **结构对比**: 测试前后结构变化对比
- **影响评估**: 变化对系统的多维度影响
- **风险评估**: 结构变更的风险等级评估
- **优化建议**: 基于结构分析的改进建议

### 🔬 深度分析扫描模式
- **安全扫描**: 危险函数、硬编码密钥、注入风险
- **性能扫描**: 循环查询、大文件处理、算法复杂度
- **质量扫描**: 圈复杂度、可维护性、代码重复率
- **架构扫描**: 依赖关系、设计模式、反模式检测

### ⚖️ 智能决策模式
- **证据收集**: 多维度证据自动收集和验证
- **推理构建**: 逻辑严密的推理链构建
- **自我反省**: 偏见识别和局限性分析
- **决策记录**: 完整的决策过程记录

## 📊 示例使用场景

### 📚 原始版本兼容示例

#### 基础测试执行
```bash
python .iflow/commands/sc/test_enhanced.py
# 发现并使用标准配置运行所有测试
# 生成通过/失败摘要和基本覆盖率
```

#### 目标覆盖率分析
```bash
python .iflow/commands/sc/test_enhanced.py src/components --type unit --coverage
# 特定目录的单元测试，具有详细覆盖率指标
```

#### 浏览器测试
```bash
python .iflow/commands/sc/test_enhanced.py --type e2e
# 激活Playwright MCP进行综合浏览器测试
# 跨浏览器兼容性和视觉验证
```

#### 开发监视模式
```bash
python .iflow/commands/sc/test_enhanced.py --watch --fix
# 具有自动简单失败修复的连续测试
# 开发期间实时反馈
```

### 🚀 增强版完整分析示例

#### 完整项目分析（推荐）
```bash
python .iflow/commands/sc/test_enhanced_launcher.py
# 执行完整的8步分析流程
# 生成全面的决策依据和优化建议
# 支持交互式深入探索
```

### 🔍 交互式深度分析
```bash
python .iflow/commands/sc/test_enhanced_main.py
# 进入交互模式，可选择：
# 1. 查看深度扫描结果
# 2. 查看功能特点分析
# 3. 查看决策记录
# 4. 查看项目结构变化
# 5. 查看优化建议
# 6. 导出详细报告
# 7. 重新分析特定文件
```

### 📈 自动化报告生成
```bash
python .iflow/commands/sc/test_enhanced_main.py --no-interactive
# 自动生成所有分析报告
# 保存到 reports/ 目录
# 包含 JSON 和 Markdown 格式
```

### 🎯 特定文件重新分析
```bash
# 在交互模式中选择选项7
# 输入特定文件路径
# 重新生成功能分析和决策记录
# 获取最新的分析结果
```

## 📄 输出报告

### 🗂️ 报告类型
1. **深度扫描报告** - 安全、性能、质量问题详情
2. **功能分析报告** - 每个文件的功能特点和价值
3. **决策记录报告** - 每个决策的详细依据
4. **优化建议报告** - 具体的改进策略和实施计划
5. **结构对比报告** - 项目结构变化分析
6. **综合分析报告** - 最终的完整分析报告

### 📁 报告位置
- **主报告目录**: `reports/`
- **AI上下文**: `.iflow/temp_docs/ai_context/`
- **决策记录**: `.iflow/temp_docs/decisions/`
- **结构快照**: `.iflow/cache/structure_analysis/`

## ⚡ 边界限制

### ✅ 将会执行
- 使用项目配置的测试运行器执行现有测试套件
- 生成覆盖率报告和质量指标
- 提供具有可操作建议的智能测试失败分析
- **新增**: 强制AI信息传递，确保AI完全理解项目
- **新增**: 深度项目结构分析和对比
- **新增**: 全面的代码质量和安全扫描
- **新增**: 每个文件的详细功能特点分析
- **新增**: 基于证据的智能决策支持
- **新增**: 自动优化报告生成
- **兼容**: 完全兼容原始版本的所有功能
- **兼容**: 支持所有原始版本的命令行参数
- **兼容**: 保留原有的5步测试流程

### ❌ 不会执行
- 生成测试用例或修改测试框架配置
- 在没有适当设置的情况下执行需要外部服务的测试
- 未经明确许可对测试文件进行破坏性更改
- **新增**: 不会删除任何文件，只提供删除建议和依据
- **新增**: 不会修改代码，只提供重构建议和决策依据
- **新增**: 不会上传任何代码到外部服务器

### 🔄 兼容性保证
- **100%兼容**: 所有原始版本的命令和参数都正常工作
- **功能保持**: 原始版本的所有功能都得到保留
- **行为一致**: 相同命令产生相同的测试结果
- **输出格式**: 保持原有的输出格式和报告结构

## 🎯 核心优势

1. **智能决策支持** - 每个决策都有详细的分析和推理过程
2. **全面证据收集** - 多维度证据支持每个决策
3. **自我反省机制** - 识别偏见和局限性
4. **完整推理链** - 逻辑严密的决策过程
5. **交互式探索** - 支持用户深入分析每个细节
6. **多格式报告** - JSON和Markdown格式的完整报告
7. **项目结构洞察** - 深度理解项目架构和变化
8. **价值评估体系** - 系统化的文件价值评估框架

---

*增强版 /sc:test - 让项目分析更智能、更全面、更可靠*
